<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>Telegram Admin</title>

    <style>
        body {
            margin: 0;
            font-family: monospace;
            background: #0f1115;
            color: #eaeaea;
        }

        header {
            padding: 12px 16px;
            background: #1a1d24;
            border-bottom: 1px solid #2a2f3a;
        }

        #status {
            color: #7ee787;
        }

        #messages {
            padding: 16px;
            height: calc(100vh - 50px);
            overflow-y: auto;
        }

        .msg {
            margin-bottom: 10px;
            padding: 8px 10px;
            background: #161a22;
            border-left: 3px solid #3b82f6;
        }

        .chat {
            color: #93c5fd;
            font-size: 12px;
        }

        .user {
            color: #facc15;
            font-size: 12px;
        }

        .text {
            margin-top: 4px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>

<header>
    <strong>Telegram Admin</strong>
    â€” <span id="status">connecting...</span>
</header>

<div id="messages"></div>

<script>
    const statusEl = document.getElementById("status")
    const messagesEl = document.getElementById("messages")

    const ws = new WebSocket(`ws://${location.host}/auth/ws/messages`)

    ws.onopen = () => {
        statusEl.textContent = "connected"
        statusEl.style.color = "#7ee787"
    }

    ws.onclose = () => {
        statusEl.textContent = "disconnected"
        statusEl.style.color = "#f87171"
    }

    ws.onerror = () => {
        statusEl.textContent = "error"
        statusEl.style.color = "#f87171"
    }

    ws.onmessage = (event) => {
        const data = JSON.parse(event.data)

        const div = document.createElement("div")
        div.className = "msg"

        div.innerHTML = `
            <div class="chat">
                chat: ${data.chat_title || data.chat_id}
            </div>
            <div class="user">
                from: ${data.sender_username || data.sender_id}
            </div>
            <div class="text">
                ${escapeHtml(data.text || "")}
            </div>
        `

        messagesEl.appendChild(div)
        messagesEl.scrollTop = messagesEl.scrollHeight
    }

    function escapeHtml(text) {
        return text
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
    }
</script>

</body>
</html>
